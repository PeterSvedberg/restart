<!--
@license
The MIT License applies unless otherwise noted. See LICENSE.md for details.
Copyright (c) 2015 Peter Svedberg.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="app-view">
  <template>
    <style>
      :host {
        @apply(--layout-fit);
        background-color: var(--dark-background-color);
        overflow: hidden;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-size: 14px;
        font-weight: 400;
        line-height: 24px;
        color: var(--primary-text-color);
      }
  
      .view {
        background-color: var(--dark-background-color);       
        @apply(--layout-vertical);
        height: 100%;
        opacity: 1;
        overflow: hidden;
      }

      #main {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        width: 100%;
        overflow: hidden;
      }

      .footer {
        height: 32px;
        background-color: var(--dark-background-color);
      }
      
      .action-panel {
        @apply(--layout-horizontal);
        margin: 0 32px 0 32px;
      }

      .app-name {
        @apply(--layout-flex);
        color: var(--dark-primary-color);
        line-height: 28px !important;
        margin: 0 16px 0 32px;
        font-size: 24px;
        font-weight: 300;
      }

      .action-button {
        margin: -16px 16px 0px 16px;
        background-color: var(--dark-background-color);
        color: var(--dark-primary-color);
      }

      .fab {
        background-color: var(--accent-color);
      }
      
      /* s */
      @media (min-width: 0px) and (max-width: 600px) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* m */
      @media (min-width: 601px) and (max-width: 1280px) {
        .action-panel {
          margin: 0 24px 0 24px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* l */
      @media (min-width: 1281px) and (max-width: 1440px) {
        #navigation {
          @apply(--standard-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--standard-actionable);        
        }

        #moreActions {
          @apply(--standard-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* xl */
      @media (min-width: 1441px) and (max-width: 1600px) {
        .action-panel {
          margin: 0 40px 0 40px;
        }
  
        .app-name {
          margin: 0 24px 0 24px;
        }
  
        .action-button {
          margin: -20px 24px 0px 24px;
        }

        #navigation {
          @apply(--large-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--large-navigation-toggle);        
        }
      
        #actionable {
          @apply(--large-actionable);
        }

        #moreActions {
          @apply(--large-more-actions);
        }
  
        #moreActions.toggle-more-actions {
          @apply(--large-more-actions-toggle);
        }  
      }
      /* xxl */
      @media (min-width: 1601px) and (max-width: 1920px) {
        .action-panel {
          margin: 0 48px 0 48px;
        }
  
        .app-name {
          margin: 0 24px 0 24px;
        }
  
        .action-button {
          margin: -20px 24px 0px 24px;
        }

        #navigation {
          @apply(--large-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--large-navigation-toggle);        
        }
      
        #actionable {
          @apply(--large-actionable);
        }

        #moreActions {
          @apply(--large-more-actions);
        }
  
        #moreActions.toggle-more-actions {
          @apply(--large-more-actions-toggle);
        }  
      }
      /* xxxl */
      @media (min-width: 1921px) {
        .action-panel {
          margin: 0 48px 0 48px;
        }
  
        .app-name {
          margin: 0 24px 0 24px;
        }
  
        .action-button {
          margin: -20px 24px 0px 24px;
        }

        #navigation {
          @apply(--large-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--large-navigation-toggle);        
        }
      
        #actionable {
          @apply(--large-actionable);
        }

        #moreActions {
          @apply(--large-more-actions);
        }
  
        #moreActions.toggle-more-actions {
          @apply(--large-more-actions-toggle);
        }  
      }
    
      /* smallPortrait */
      @media (min-width: 0px) and (max-width: 360px) and (orientation: portrait) {
        .action-panel {
          margin: 0 8px 0 8px;
        }
  
        .app-name {
          margin: 0 8px 0 8px;
        }

        .action-button {
          margin: -20px 8px 0px 8px;
        }

        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* mediumPortrait */
      @media (min-width: 361px) and (max-width: 600px) and (orientation: portrait) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* largePortrait */
      @media (min-width: 601px) and (max-width: 840px) and (orientation: portrait) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* xlPortrait */
      @media (min-width: 841px) and (max-width: 1280px) and (orientation: portrait) {
        .action-panel {
          margin: 0 24px 0 24px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      
      /* smallLandscape */
      @media (min-width: 0px) and (max-width: 480px) and (orientation: landscape) {
        .action-panel {
          margin: 0 16px 0 16px;
        }

        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* mediumLandscape */
      @media (min-width: 481px) and (max-width: 600px) and (orientation: landscape) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* largeLandscape */
      @media (min-width: 601px) and (max-width: 960px) and (orientation: landscape) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* xlLandscape */
      @media (min-width: 961px) and (max-width: 1280px) and (orientation: landscape) {
        .action-panel {
          margin: 0 24px 0 24px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      
    </style>
    
    <layout-state id="ls" media="{{media}}"></layout-state>
    <data-surface id="ds" actionables="{{actionables}}" selected-actionable="{{selectedActionable}}"></data-surface>
    <div class="view">
      <div id="main">
        <paper-material id="navigation" elevation="1">
          <actionables-list id="actionablesList" actionables="{{actionables}}" selected-actionable="{{selectedActionable}}"></actionables-list>
        </paper-material>
        <paper-material id="actionable" elevation="1">
          <actionable-panel id="actionablePanel" actionable="{{selectedActionable}}"></actionable-panel>
        </paper-material> 
        <paper-material id="moreActions" elevation="1">
          <app-actions-panel></app-actions-panel>
        </paper-material>            
      </div>
      <div class="footer">
        <div class="action-panel">
          <paper-fab mini class="action-button" icon="list" on-tap="_toggleNavigation"></paper-fab>
          <paper-fab mini class="action-button fab" icon="add" on-tap="_createActionable"></paper-fab>
          <div class="app-name">listicle</div>
          <paper-fab mini class="action-button" icon="more-vert" on-tap="_toggleMoreActions"></paper-fab>
        </div>
      </div>
    </div>
  </template>

  <script>
    'use strict';
    
    (function() {
      class AppView {
        beforeRegister() {
          this.is = 'app-view';
  
          this.properties = {
            actionables: {
              type: Array,
              notify: true,
              value: () => []
            },
            
            selectedActionable: {
              type: Object,
              notify: true,
              value: () => {},
              observer: '_selectedActionableChanged'
            },
                        
            isCreateDialogImported: false

          };         
        }
        
        attached() {
          addEventListener('resize', () => {
            this._setHeight();
          });
          this._setHeight();
        }
        
        _setHeight() {
          if (this.$.main) {
            var height = this.$.ls.setHeight(this.$.main.offsetHeight);
            Polymer.dom(this.$.navigation).setAttribute('style', height);
            Polymer.dom(this.$.actionable).setAttribute('style', height);
            Polymer.dom(this.$.moreActions).setAttribute('style', height);
          } 
        }
        
        _selectedActionableChanged() {
          this.$.ls.toggleNavigation(this.$.navigation, this.$.moreActions, true);
        }
        
        _toggleNavigation() {
          this.$.ls.toggleNavigation(this.$.navigation, this.$.moreActions, false);
        }
        
        _toggleMoreActions() {
          this.$.ls.toggleMoreActions(this.$.navigation, this.$.moreActions);
        }
        
        _createActionable() {
          if (this.isCreateDialogImported) {
            this._doCreateActionable();
          } else {
            this._importCreateDialogAndContinue();
          }
        }
        
        _doCreateActionable() {
          var createDialog = document.createElement('create-dialog');
          createDialog.setHeading('New List');
          createDialog.setPlaceholder('Name of list (required)');
          createDialog.setEvent('createActionable');
          Polymer.dom(this.$.main).appendChild(createDialog);
        }
        
        _importCreateDialogAndContinue() {
            /* jshint unused: false */
            this.importHref('elements/create-dialog/create-dialog.html', e => {
              this.isCreateDialogImported = true;
              this._doCreateActionable();             
            }, e => {
              console.log('failed to import create-dialog ' + e);
            });
        }        
      }
      
      new Polymer(AppView);
      
    })();
  </script>

</dom-module>