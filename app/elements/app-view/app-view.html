<!--
@license
The MIT License applies unless otherwise noted. See LICENSE.md for details.
Copyright (c) 2015 Peter Svedberg.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="app-view">
  <template>
    <style>
      :host {
        @apply(--layout-fit);
        background-color: var(--primary-background-color);
        overflow: hidden;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-size: 14px;
        font-weight: 400;
        line-height: 24px;
        color: var(--primary-text-color);

        --paper-card-header-color: var(--secondary-text-color);
        --paper-card-content: {
          padding: 0 16px 24px 16px;
        }
        --paper-card-actions: {
          color: var(--secondary-text-color);
        }
      }
  
      #createActionableEditor {
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease-out 0.02s;        
        position: absolute;
        left: 32px;
        top: 24px;
        width: 280px;
        background-color: var(--primary-background-color);       
      }
      
      #createActionableEditor.show {
        z-index: 6;
        opacity: 1;
      }
      
     .topEdge {
        height: 1px;
        background-color: var(--light-primary-color);
      }
      
      .view {
        background-color: var(--primary-background-color);       
        @apply(--layout-vertical);
        height: 100%;
        opacity: 1;
        overflow: hidden;
      }

      #main {
        @apply(--layout-flex);
        background-color: var(--primary-background-color);       
        @apply(--layout-horizontal);
        width: 100%;
        overflow: hidden;
      }

      .footer {
        height: 32px;
        background-color: var(--dark-background-color);
        border-top: 1px solid var(--divider-color);
      }
      
      .action-panel {
        @apply(--layout-horizontal);
        margin: 0 32px 0 32px;
      }

      .app-name {
        @apply(--paper-font-title);
        @apply(--layout-flex);
        color: var(--default-primary-color);
        line-height: 28px !important;
        margin: 0 16px 0 16px;
      }

      .action-button {
        margin: -20px 16px 0px 16px;
        background-color: var(--dark-background-color);
        color: var(--button-primary-color);
      }

      .fab {
        background-color: var(--accent-color);
        color: var(--text-primary-color);
      }
      
      /* s */
      @media (min-width: 0px) and (max-width: 600px) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* m */
      @media (min-width: 601px) and (max-width: 1280px) {
        .action-panel {
          margin: 0 24px 0 24px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* l */
      @media (min-width: 1281px) and (max-width: 1440px) {
        #navigation {
          @apply(--standard-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--standard-actionable);        
        }

        #moreActions {
          @apply(--standard-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* xl */
      @media (min-width: 1441px) and (max-width: 1600px) {
        .action-panel {
          margin: 0 40px 0 40px;
        }
  
        .app-name {
          margin: 0 24px 0 24px;
        }
  
        .action-button {
          margin: -20px 24px 0px 24px;
        }

        #navigation {
          @apply(--large-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--large-navigation-toggle);        
        }
      
        #actionable {
          @apply(--large-actionable);
        }

        #moreActions {
          @apply(--large-more-actions);
        }
  
        #moreActions.toggle-more-actions {
          @apply(--large-more-actions-toggle);
        }  
      }
      /* xxl */
      @media (min-width: 1601px) and (max-width: 1920px) {
        .action-panel {
          margin: 0 48px 0 48px;
        }
  
        .app-name {
          margin: 0 24px 0 24px;
        }
  
        .action-button {
          margin: -20px 24px 0px 24px;
        }

        #navigation {
          @apply(--large-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--large-navigation-toggle);        
        }
      
        #actionable {
          @apply(--large-actionable);
        }

        #moreActions {
          @apply(--large-more-actions);
        }
  
        #moreActions.toggle-more-actions {
          @apply(--large-more-actions-toggle);
        }  
      }
      /* xxxl */
      @media (min-width: 1921px) {
        .action-panel {
          margin: 0 48px 0 48px;
        }
  
        .app-name {
          margin: 0 24px 0 24px;
        }
  
        .action-button {
          margin: -20px 24px 0px 24px;
        }

        #navigation {
          @apply(--large-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--large-navigation-toggle);        
        }
      
        #actionable {
          @apply(--large-actionable);
        }

        #moreActions {
          @apply(--large-more-actions);
        }
  
        #moreActions.toggle-more-actions {
          @apply(--large-more-actions-toggle);
        }  
      }
    
      /* smallPortrait */
      @media (max-width: 360px) and (orientation: portrait) {
        .action-panel {
          margin: 0 8px 0 8px;
        }
  
        .app-name {
          margin: 0 8px 0 8px;
        }

        .action-button {
          margin: -20px 8px 0px 8px;
        }

        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* mediumPortrait */
      @media (min-width: 361px) and (max-width: 600px) and (orientation: portrait) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* largePortrait */
      @media (min-width: 601px) and (max-width: 840px) and (orientation: portrait) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* xlPortrait */
      @media (min-width: 841px) and (max-width: 1280px) and (orientation: portrait) {
        .action-panel {
          margin: 0 24px 0 24px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      
      /* smallLandscape */
      @media (max-width: 480px) and (orientation: landscape) {
        .action-panel {
          margin: 0 16px 0 16px;
        }

        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* mediumLandscape */
      @media (min-width: 481px) and (max-width: 600px) and (orientation: landscape) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--small-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--small-navigation-toggle);        
        }

        #actionable {
          @apply(--layout-flex);
        }

        #actionable.toggle-actionable {
          display: none;
        }

        #moreActions {
          width: 0;
          transition: all 0.3s ease-out 0.02s;        
        }
  
        #moreActions.toggle-more-actions {
          width: 100%;
        }   
      }
      /* largeLandscape */
      @media (min-width: 601px) and (max-width: 960px) and (orientation: landscape) {
        .action-panel {
          margin: 0 16px 0 16px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      /* xlLandscape */
      @media (min-width: 961px) and (max-width: 1280px) and (orientation: landscape) {
        .action-panel {
          margin: 0 24px 0 24px;
        }
  
        #navigation {
          @apply(--medium-navigation);        
        }
  
        #navigation.toggle-navigation {
          @apply(--standard-navigation-toggle);        
        }
      
        #actionable {
          @apply(--medium-actionable);        
        }

        #moreActions {
          @apply(--medium-more-actions);        
        }
  
        #moreActions.toggle-more-actions {
          @apply(--standard-more-actions-toggle);        
        }     
      }
      
    </style>

    <iron-media-query query="(min-width: 0px) and (max-width: 600px)" query-matches="{{s}}"></iron-media-query>
    <iron-media-query query="(min-width: 601px) and (max-width: 1280px)" query-matches="{{m}}"></iron-media-query>
    <iron-media-query query="(min-width: 1281px) and (max-width: 1440px)" query-matches="{{l}}"></iron-media-query>
    <iron-media-query query="(min-width: 1441px) and (max-width: 1600px)" query-matches="{{xl}}"></iron-media-query>
    <iron-media-query query="(min-width: 1601px) and (max-width: 1920px)" query-matches="{{xxl}}"></iron-media-query>
    <iron-media-query query="(min-width: 1921px)" query-matches="{{xxxl}}"></iron-media-query>
    
    <iron-media-query query="(max-width: 360px) and (orientation: portrait)" query-matches="{{smallPortrait}}"></iron-media-query>
    <iron-media-query query="(min-width: 361px) and (max-width: 600px) and (orientation: portrait)" query-matches="{{mediumPortrait}}"></iron-media-query>
    <iron-media-query query="(min-width: 601px) and (max-width: 840px) and (orientation: portrait)" query-matches="{{largePortrait}}"></iron-media-query>
    <iron-media-query query="(min-width: 841px) and (max-width: 1280px) and (orientation: portrait)" query-matches="{{xlPortrait}}"></iron-media-query>
    
    <iron-media-query query="(max-width: 480px) and (orientation: landscape)" query-matches="{{smallLandscape}}"></iron-media-query>
    <iron-media-query query="(min-width: 481px) and (max-width: 600px) and (orientation: landscape)" query-matches="{{mediumLandscape}}"></iron-media-query>
    <iron-media-query query="(min-width: 601px) and (max-width: 960px) and (orientation: landscape)" query-matches="{{largeLandscape}}"></iron-media-query>
    <iron-media-query query="(min-width: 961px) and (max-width: 1280px) and (orientation: landscape)" query-matches="{{xlLandscape}}"></iron-media-query>
    
    <data-surface id="ds" actionables="{{actionables}}" selected-actionable="{{selectedActionable}}"></data-surface>
    <paper-card id="createActionableEditor" elevation="2" heading="Create List">
      <div class="card-content">
        <paper-input id="actionableName" on-keyup="_createOnEnter" autofocus label="Name of List"></paper-input>
      </div>
      <div class="card-actions">
        <paper-button on-tap="_cancel"><iron-icon icon="clear"></iron-icon></paper-button>
        <paper-button on-tap="_create"><iron-icon icon="check"></iron-icon></paper-button>
      </div>
    </paper-card>
    <div class="view">
      <div class="topEdge"></div>
      <div id="main">
        <paper-material id="navigation" elevation="1">
          <actionables-list id="actionablesList" actionables="{{actionables}}" selected-actionable="{{selectedActionable}}"></actionables-list>
        </paper-material>
        <paper-material id="actionable" elevation="1">
          <actionable-panel id="actionablePanel" actionable="{{selectedActionable}}"></actionable-panel>
        </paper-material> 
        <paper-material id="moreActions" elevation="1">
          <app-actions-panel></app-actions-panel>
        </paper-material>            
      </div>
      <div class="footer">
        <div class="action-panel">
          <paper-fab mini class="action-button" icon="list" on-tap="_toggleNavigation"></paper-fab>
          <paper-fab mini class="action-button fab" icon="add" on-tap="_createActionable"></paper-fab>
          <div class="app-name">listicle</div>
          <paper-fab mini class="action-button" icon="more-vert" on-tap="_toggleMoreActions"></paper-fab>
        </div>
      </div>
    </div>
  </template>

  <script>
    'use strict';
    
    (function() {
      class AppView {
        beforeRegister() {
          this.is = 'app-view';
  
          this.properties = {
            actionables: {
              type: Array,
              notify: true,
              observer: '_actionablesChanged'
            },
            
            selectedActionable: {
              type: Object,
              notify: true,
              observer: '_selectedActionableChanged'
            },
            
            isOneColumn: false,
            isTwoColumn: false,
            isThreeColumn: false,
  
            s: false,
            m: false,
            l: false,
            xl: false,
            xxl: false,
            xxxl: false,
            
            smallPortrait: false,
            mediumPortrait: false,
            largePortrait: false,
            xlPortrait: false,
              
            smallLandscape: false,
            mediumLandscape: false,
            largeLandscape: false,
            xlLandscape: false,
            
            navOpen: false,          
            moreActionsOpen: false,
            wasNavOpen: false,          
            wasMoreActionsOpen: false,
            isTogglingNav: false,          
            isTogglingMoreActions: false,
            
            layoutHeight: 0
          };
          
        }
        
        _actionablesChanged() {
          console.log('_actionablesChanged');          
        }
        
        _selectedActionableChanged() {
          if (this.selectedActionable === null) {
            return;
          }
          console.log('this.selectedActionable changed ' + this.selectedActionable.id);
          if (this.isOneColumn && this.navOpen) {
            this._toggleNavigation();
          }
        }
        
        attached() {
          addEventListener('resize', () => {
            this._calcDimensions();
          });
          this._calcDimensions();
          this.navOpen = !this.isOneColumn;
          this.moreActionsOpen = this.isThreeColumn;
          this._logMedia();
        }
        
        _calcDimensions() {
          this.isOneColumn = this.s || this.smallPortrait || this.mediumPortrait || this.smallLandscape || this.mediumLandscape;
          this.isTwoColumn = this.m || this.l || this.largePortrait || this.xlPortrait || this.largeLandscape || this.xlLandscape;
          this.isThreeColumn = this.xl || this.xxl || this.xxxl;
          this._setHeight();
        }
        
        _logMedia() {
          console.log('isOneColumn:' + this.isOneColumn); 
          console.log('isTwoColumn:' + this.isTwoColumn); 
          console.log('isThreeColumn:' + this.isThreeColumn); 
          
          console.log('s:' + this.s); 
          console.log('m:' + this.m); 
          console.log('l:' + this.l); 
          console.log('xl:' + this.xl);
          console.log('xxl:' + this.xxl);
          console.log('xxxl:' + this.xxxl);
          
          console.log('smallPortrait:' + this.smallPortrait);
          console.log('mediumPortrait:' + this.mediumPortrait);
          console.log('largePortrait:' + this.largePortrait);
          console.log('xlPortrait:' + this.xlPortrait);
          
          console.log('smallLandscape:' + this.smallLandscape);
          console.log('mediumLandscape:' + this.mediumLandscape);
          console.log('largeLandscape:' + this.largeLandscape);
          console.log('xlLandscape:' + this.xlLandscape);
        }
            
        _setHeight() {
          if (!this.$.main) {
            return;
          }
          this.layoutHeight = this.$.main.offsetHeight;
          // console.log('this.$.main.offsetHeight:' + this.layoutHeight); 
          var height = 'height:' + this._computeHeight() + 'px;';
          // console.log('height:' + height); 
          this.$.navigation.setAttribute('style', height);
          this.$.actionable.setAttribute('style', height);
          this.$.moreActions.setAttribute('style', height);
        }
        
        _computeHeight() {
          var h = this.layoutHeight;
          if (this.isOneColumn) {
            return h -= 0; 
          } else if (this.isTwoColumn) {
            if (this.m || this.xlPortrait || this.mediumLandscape || this.largeLandscape || this.xlLandscape) {
              return h -= 16;
            } else {
              return h -= 24;
            }
          } else if (this.isThreeColumn) {
            return h -= 32;
          }
        }
        
        _removeToggleNavigationClass() {
          // navigation is initially closed in one column layout (add class to open)
          // otherwise open (add class to close)
          var remove = this.isOneColumn ? !this.navOpen : this.navOpen;
          return remove;
        }
        
        _toggleNavigation() {
          this.isTogglingNav = true;
          if (this._shouldToggleMoreActions()) {
            this._toggleMoreActions();
          }
          Polymer.Base.toggleClass('toggle-navigation', this._removeToggleNavigationClass(), this.$.navigation);
          this.isTogglingNav = false;
          this.navOpen = !this.navOpen;
        }
        
        _shouldToggleMoreActions() {
          if (this.isTogglingMoreActions) {
            // not more than once
            return false;
          }
          if (this.isThreeColumn) {
            return false;
          }
          if (this.isOneColumn) {
            return this.moreActionsOpen;
          }
          if (this.isTwoColumn && (this.moreActionsOpen || this.wasMoreActionsOpen)) {
            this.wasMoreActionsOpen = this.moreActionsOpen ? true : false;
            return true;
          }
          return false;
        }
        
        _removeToggleMoreActionsClass() {
          // more actions is initially open in three column layout (add class to close)
          // otherwise closed (add class to open)
          var remove = this.isThreeColumn ? this.moreActionsOpen : !this.moreActionsOpen;
          return remove;
        }
        
        _toggleMoreActions() {
          this.isTogglingMoreActions = true;
          if (this._shouldToggleNavigation()) {
            this._toggleNavigation();
          }
          Polymer.Base.toggleClass('toggle-more-actions', this._removeToggleMoreActionsClass(), this.$.moreActions);
          this.isTogglingMoreActions = false;
          this.moreActionsOpen = !this.moreActionsOpen;
        }
        
        _shouldToggleNavigation() {
          if (this.isTogglingNav) {
            // not more than once
            return false;
          }
          if (this.isThreeColumn) {
            return false;
          }
          if (this.isOneColumn) {
            return this.navOpen;
          }
          if (this.isTwoColumn && (this.navOpen || this.wasNavOpen)) {
            this.wasNavOpen = this.navOpen ? true : false;
            return true;
          }
          return false;
        }
        
        _createActionable() {
          Polymer.Base.toggleClass('show', true, this.$.createActionableEditor);
        }
        
        _cancel() {
          this.$.actionableName.value = '';
          Polymer.Base.toggleClass('show', false, this.$.createActionableEditor);
        }
        
        _doCreate() {
          var name = this.$.actionableName.value;
          this.fire('createActionable', {'name': name});
          this.$.actionableName.value = '';
          Polymer.Base.toggleClass('show', false, this.$.createActionableEditor);
        }
  
        _create() {
          this._doCreate();
        }
  
        _createOnEnter(e) {
          if (e.keyCode === 13) {
            this._doCreate();
          }
        }
      }
      new Polymer(AppView);
    })();
  </script>

</dom-module>